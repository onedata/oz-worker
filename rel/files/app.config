[
    %% SASL config
    {sasl, [{sasl_error_logger, false}]},

    %% logger configuration
    {lager, [
        {colored, true},
        {handlers, [
            %% show info level or higher level logs at console
            {lager_console_backend, info},
            %% rotate error log when it reaches 50 MB; keep 10 rotated logs
            {lager_file_backend, [{file, "{{platform_log_dir}}/error.log"}, {level, error}, {size, 52428800}, {count, 10}]},
            %% rotate info log when it reaches 50 MB; keep 10 rotated logs
            {lager_file_backend, [{file, "{{platform_log_dir}}/info.log"}, {level, info}, {size, 52428800}, {count, 10}]},
            %% rotate debug log when it reaches 50 MB; keep 10 rotated logs
            {lager_file_backend, [{file, "{{platform_log_dir}}/debug.log"}, {level, debug}, {size, 52428800}, {count, 10}]}
        ]},
        % Limit for the number of messages per second allowed from error_logger
        {error_logger_hwm, 200},
        % When lager should change mode to synchronous (log queue is longer than async_threshold)
        {async_threshold, 500},
        % When lager should return from synchronous mode to asynchronous (log queue is shorter than (async_threshold - async_threshold_window)
        {async_threshold_window, 50}
    ]},

    %% cluster_worker config
    {cluster_worker, [

        %% ===================================================================
        %% PLUGINS
        %% ===================================================================

        % names of modules implementing given plugins
        {datastore_config_plugin, datastore_config_plugin},
        {node_manager_plugin, node_manager_plugin},
        {dns_worker_plugin, dns_worker_plugin},
        {identity_repository, located_rest_identity_repository},

        %% ===================================================================
        %% DNS
        %% ===================================================================

        %% DNS port
        {dns_port, 53},
        %% Maximum supported UDP size, that will be advertised by the server (via EDNS). If a client advertises a bigger
        %% value, it will be assumed to be as high as this.
        {edns_max_udp_size, 1280},
        %% Number of dns tcp acceptors
        {dns_tcp_acceptor_pool_size, 20},
        %% Time (in sec) after which dns closes idle connection
        {dns_tcp_timeout, 20},
        %% DNS config file location
        {dns_config_file, "{{platform_data_dir}}/dns.config"},

        %% ===================================================================
        %% Datastore changes
        %% ===================================================================

        {couchbase_changes_batch_size, 3},
        {couchbase_changes_update_interval, 1000},
        {couchbase_changes_stream_batch_size, 3},
        {couchbase_changes_stream_update_interval, 1000},

        {datastore_cache_size, [
            {memory, 200000},
            {disc, 500000}
        ]},

        {throttling_delay_db_queue_size, 20000},
        {throttling_db_queue_limit, 150000}
    ]},

    %% oz_worker config
    {oz_worker, [
        % Developer mode - enables developer features such as REST endpoints
        % with functionalities used in tests.
        {dev_mode, false},

        % Build version in form:
        % <number of commits since last tag>-g<last commit hash abbrev>
        % e.g. 19-g0d0fd5b
        {build_version, "{{{build_version}}}"},

        % Ports used by application
        {application_ports, [53, 80, 443, 7443, 7770, 7771, 8443]},

        %% Also used as the certificate domain and to provider CRLs.
        {http_domain, "127.0.0.1"},

        %% External IP of this node - used by load balancing (for DNS)
        {external_ip, "127.0.0.1"},

        % Name of OZ instance
        {oz_name, "unnamed"},
        {admin_emails, ["info@onedata.org"]},

        %% List of beam directories to be covered, cover is not started if list is empty
        {covered_dirs, []},
        %% List of modules to be excluded during cover analysis
        {covered_excluded_modules, []},

        %% zone CA config
        {ozpca_dir, "{{platform_data_dir}}/ozpca"},
        {oz_key_file, "{{platform_data_dir}}/ozpca/oz_key.pem"},
        {oz_cert_file, "{{platform_data_dir}}/ozpca/oz_cert.pem"},

        %% server certificates
        %% todo generate dedicated certs (this are example ones)
        {web_key_file, "{{platform_etc_dir}}/certs/web_key.pem"},
        {web_cert_file, "{{platform_etc_dir}}/certs/web_cert.pem"},
        {cacerts_dir, "{{platform_etc_dir}}/cacerts"},

        %% REST config
        {rest_port, 8443},
        {rest_https_acceptors, 50},
        %% Prefix to the REST API - all paths must begin with it.
        {rest_api_prefix, "/api/v3/onezone"},
        %% Macaroons authorization
        {authorization_macaroon_expiration_seconds, 31536000}, % 1 year
%%        {authentication_macaroon_expiration_seconds, 900}, % 15 minutes
        % @todo for now make the authentication macaroons live longer,
        % until automatic refreshing by provider is implemented: VFS-1766
        {authentication_macaroon_expiration_seconds, 36000}, % 10 hours

        %% GUI config
        {gui_port, 443},
        {gui_https_acceptors, 100},
        {gui_socket_timeout, 60000},
        {gui_max_keepalive, 30},
        {gui_cookie_ttl_seconds, 3600}, % one hour
        {auth_config_file, "{{platform_data_dir}}/auth.config"},
        {saml_config_file, "{{platform_data_dir}}/saml.config"},
        % After this time, login procedure via OIDC/SAML expires (if not completed)
        {state_token_ttl_secs, 300},
        %% List of HTTP headers that will be send with every response.
        {gui_response_headers, [
            {<<"X-Frame-Options">>, <<"SAMEORIGIN">>}
%%            {<<"Strict-Transport-Security">>, <<"max-age=31536000; includeSubDomains">>}
        ]},

        %% Directory where static files of default, embedded GUI are kept.
        %% Used when gui_custom_static_root is non-existent or empty.
        {gui_default_static_root, "{{platform_data_dir}}/gui_static"},
        %% Directory where onezone tries to find static files of a custom GUI.
        %% If the directory is not empty, it will serve the static files
        %% from it. If not, it will fall back to default, embedded GUI.
        {gui_custom_static_root, "/var/www/html/oz_worker"},

        %% Decides if docs proxy shall be used. Related envs are used only
        %% when true.
        {gui_docs_proxy_enabled, true},
        %% Root path of all documentation-related static files. They are served
        %% by following a HTTP request to a third-party server with static
        %% files (the response is followed back to the client).
        %% Must start with a slash and NOT end with a slash.
        {gui_docs_static_root, "/docs"},
        %% URL of the server with documentation
        {gui_docs_server, "http://172.17.0.2:8080"},

        %% HTTP redirector config
        {gui_redirect_port, 80},
        {gui_redirect_acceptors, 10},

        %% DB config
        {db_nodes, ['db@127.0.0.1']},
        {view_def_location, "{{platform_data_dir}}/views/"},

        %% Subscriptions config
        {history_changes_stream_life_limit_seconds, 10},
        {changes_stream_presence_check_interval_seconds, 30},
        {wait_for_latest_changes_in_cache, 1500},
        {subscriptions_sent_revisions_limit, 40},
        {subscription_cache_size, 1000},
        {subscription_batch_ttl, 2000},
        {subscriptions_wss_port, 7443},
        {subscroptions_https_acceptors, 50},

        %% Location Service config
        {location_service_enabled, false},
        %% Port of DHT client
        {location_service_port, 7770},
        %% Port for communication between OZ and DHT client (internal use only)
        {location_service_rest_port, 7771},
        %% List of any other known OZ with DHT clients running
        %% Port of DHT client is mandatory
        {location_service_bootstrap_nodes, ['onedata.org:7770']},
        %% Root path of a location service library
        {location_service_lib_path, "{{platform_lib_dir}}/location-service"},
        %% Verbosity level of a location service library
        {location_service_log_level, 2},

        %% Identity verification config
        {public_key_refresh_interval_seconds, 600},
        {identity_key_file, "{{platform_data_dir}}/ozpca/identity_key.pem"},
        {identity_cert_file, "{{platform_data_dir}}/ozpca/identity_cert.pem"},

        %% Decides if every user should get a new space when an account for
        %% him is created.
        {enable_automatic_first_space, false},

        %% Minimum size of support that a provider must offer (smaller values
        %% will be declined).
        {minimum_space_support_size, 1000000}, % 1 MB

        %% Predefined groups config - groups that are created automatically
        %% after the application has started. If the groups exist, no action
        %% is performed.
        %% Each group is represented by a map with keys
        %% id, name, oz_privileges.
        %% Allows to specify the ID, name and OZ API privileges of every group.
        %% oz_privileges can be either an explicit list of privileges or a
        %% tuple of atoms indicating module and function to call which must
        %% return the list of privileges.
        {predefined_groups, [
            #{
                id => <<"admins">>,
                name => <<"Admins">>,
                oz_privileges => {privileges, oz_privileges}
            },
            #{
                id => <<"all_users">>,
                name => <<"All users">>,
                oz_privileges => []
            }
        ]},

        %% Decides if global groups should be enabled. If so, every user that
        %% is created will automatically be added to group defined in
        %% the global_groups env variable.
        {enable_global_groups, false},

        %% A list of global groups - every new user is added to them if the
        %% enable_global_groups variable is true. Must contain a list of tuples:
        %%     the first element is the id of a group (must be pre-created using
        %%         the predefined_groups variable)
        %%     the second element is the list of group privileges that will be
        %%         granted by default to users that are added to the group.
        {global_groups, [
            {<<"all_users">>, []}
        ]},

        %% Mapping onepanel_role => [group_id]. When a user is
        %% retrieved from onepanel, his role will be sent in response. This env
        %% allows to define to which groups such user should be added
        %% automatically upon first login.
        %% If the role changes, any consecutive login will cause the user
        %% to be added to all groups connected to his new role, but will not
        %% cause the user to be removed from any group!
        {onepanel_role_to_group_mapping, #{
            <<"admin">> => [<<"admins">>]
        }},

        %% Onepanel interface config
        {onepanel_rest_url, "https://127.0.0.1:9443"},
        {onepanel_users_endpoint, "/api/v3/onepanel/users/"},

        %% Options used in SMTP client to send emails via SMTP relay.
        {smtp_client_config, #{
            relay => "smtp.gmail.com",
            username => "username@gmail.com",
            password => "password"
        }},

        %% OAI-PMH config
        %% Prefix to the OAI-PMH API - all paths must begin with it
        {oai_pmh_api_prefix, "/oai_pmh"}
    ]}
].
