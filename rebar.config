%% behaviours should be compiled before other files
{erl_first_files, [
    "src/auth/auth_modules/auth_module_behaviour.erl",
    "src/handlers/rest_module_behavior.erl",
    "deps/ctool/annotations/perf_test.erl"
]}.


{sub_dirs, ["rel"]}.

{clean_files, [
    "ebin/*.beam",
    "test/eunit_results",
    "test_distributed/*/*.beam",
    "test_distributed/log/*",
    "variables-ct*"
]}.

%% to include deps headers
{lib_dirs, ["deps", "deps/annotations"]}.

{cover_enabled, true}.

%% eunit opts - Maven-like output formatting
{eunit_opts, [verbose, {report, {eunit_surefire, [{dir, "../test/eunit_results"}]}}]}.

{deps, [
    {ctool, ".*", {git, "ssh://git@git.plgrid.pl:7999/vfs/ctool.git", {tag, "c525fd38dbe"}}},
    {meck, "0.8.2", {git, "https://github.com/eproxus/meck.git", {tag, "0.8.2"}}},
    {mochiweb, "2.8.0", {git, "git://github.com/mochi/mochiweb.git", {tag, "v2.8.0"}}},
    {parse_trans, ".*", {git, "https://github.com/esl/parse_trans.git", {tag, "763462825e"}}},
    {annotations, ".*", {git, "https://github.com/hyperthunk/annotations.git", {tag, "3f257db848"}}},
    {dao, ".*", {git, "ssh://git@git.plgrid.pl:7999/vfs/dao.git", {tag, "014a10d4450"}}},
    {websocket_client, ".*", {git, "git://github.com/RoXeon/websocket_client", {tag, "c8a2554"}}},
    {prproto, ".*", {git, "ssh://git@git.plgrid.pl:7999/vfs/prproto.git", {tag, "56de51abdf9"}}, [raw]},
    {protobuffs, "0.8.1p4", {git, "https://github.com/basho/erlang_protobuffs.git", {tag, "0.8.1p4"}}}
]}.

%% annotations
{plugins, [rebar_annotations_plugin]}.

{erl_opts, [
    fail_on_warning,
    debug_info,
    {src_dirs, ["src", "test_distributed"]}
]}.

{pre_hooks, [
    {'get-deps', "./update_onedev.sh"},
    {eunit, "mkdir -p test/eunit_results"}, %% Make dir for eunit' surefire test results
    {eunit, "epmd -daemon"}, %% Sometimes, in some cases epmd daemon doesn't start during eunit tests, so we need to force start it
    {compile, "mkdir -p test_distributed/log"},
    % gen_dev compilation
    {clean, "make -C bamboos/gen_dev/ clean"},
    {compile, "make -C bamboos/gen_dev/ compile"}
]}.

{post_hooks, [
    {'get-deps', "cp -Rf ./deps/ctool/src/gui_static/* ./src/gui/gui_static/"},
    {compile, "cp ebin/*SUITE* test_distributed/"}
]}.

% Options for erlyDTL (templates for GUI)
{erlydtl_opts, [
    {compiler_options, [debug_info]},
    {doc_root, "src/gui/gui_static/templates"},
    {out_dir, "ebin"},
    {source_ext, ".html"},
    {module_ext, "_view"}
]}.
