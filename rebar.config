%% behaviours should be compiled before other files
{erl_first_files, [
    "src/auth/auth_modules/auth_module_behaviour.erl",
    "src/handlers/rest_module_behavior.erl"
]}.

{sub_dirs, ["rel"]}.

{clean_files, [
    "test/eunit_results",
    "test_distributed/*.beam",
    "test_distributed/logs/*"
]}.

%% to include deps headers
{lib_dirs, ["deps"]}.

%% TODO - enable after upgrade to Erlang 18.3
%% {cover_enabled, true}.
%% {cover_export_enabled, true}.

%% eunit opts - Maven-like output formatting
{eunit_opts, [verbose, {report, {eunit_surefire, [{dir, "../test/eunit_results"}]}}]}.

{deps, [
    {ctool, "3.0.0-alpha3", {git, "${ONEDATA_GIT_URL}/ctool.git", {tag, "0261509cc9d"}}},
    {gui, "1.0.3", {git, "ssh://git@git.plgrid.pl:7999/vfs/gui.git", {tag, "94d0ef9"}}},
    {meck, "0.8.2", {git, "https://github.com/eproxus/meck.git", {tag, "0.8.2"}}},
    {parse_trans, "2.9.2", {git, "https://github.com/uwiger/parse_trans.git", {tag, "2.9.2"}}},
    {annotations, ".*", {git, "https://github.com/RoXeon/annotations.git", "HEAD"}},
    {cluster_worker, "3.0.0-beta1", {git, "${ONEDATA_GIT_URL}/cluster-worker.git", {tag, "ff34f0d6d6d"}}},
    {node_package, ".*", {git, "git://github.com/onedata/node_package.git", {branch, "2.0.2"}}}
]}.

%% plugins
{plugins, [rebar_git_plugin, rebar_annotations_plugin]}.

{erl_opts, [
    fail_on_warning,
    debug_info,
    {src_dirs, ["src"]}
]}.

{pre_hooks, [
    %% Make dir for eunit' surefire test results
    {eunit, "mkdir -p test/eunit_results"},
    %% Sometimes, in some cases epmd daemon doesn't
    %% start during eunit tests, so we need to force start it
    {eunit, "epmd -daemon"},
    {clean, "make gui_clean"}
]}.
